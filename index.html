<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Math Balloons Game</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      font-family: "Comic Sans MS", sans-serif;
      background: url('https://i.ibb.co/VvnbMrt/cartoon-bg.jpg') no-repeat center center fixed;
      background-size: cover;
    }
    #gameCanvas {
      display: block;
      margin: auto;
      background: transparent;
    }
    #ui {
      position: absolute;
      top: 10px;
      left: 50%;
      transform: translateX(-50%);
      display: flex;
      gap: 30px;
      font-size: 22px;
      font-weight: bold;
      color: #fff;
      text-shadow: 2px 2px 4px #000;
    }
    #question {
      position: absolute;
      top: 60px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 28px;
      font-weight: bold;
      color: yellow;
      text-shadow: 2px 2px 4px #000;
    }
    #message {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      font-size: 36px;
      color: #fff;
      text-shadow: 2px 2px 5px #000;
      display: none;
    }
  </style>
</head>
<body>
  <div id="ui">
    <div>Score: <span id="score">0</span></div>
    <div>Level: <span id="level">1</span></div>
    <div>Time: <span id="time">30</span>s</div>
  </div>
  <div id="question">Question: ?</div>
  <div id="message"></div>
  <canvas id="gameCanvas" width="800" height="600"></canvas>

  <audio id="bgMusic" loop autoplay>
    <source src="https://www.bensound.com/bensound-music/bensound-littleidea.mp3" type="audio/mpeg">
  </audio>

  <script>
    const canvas = document.getElementById("gameCanvas");
    const ctx = canvas.getContext("2d");

    let balloons = [];
    let score = 0;
    let level = 1;
    let time = 30;
    let correctAnswer = 0;
    let question = "";
    let gameInterval, timerInterval;

    const colors = ["red","blue","green","purple","orange","pink","cyan"];

    class Balloon {
      constructor(x, y, value, isCorrect) {
        this.x = x;
        this.y = y;
        this.value = value;
        this.isCorrect = isCorrect;
        this.radius = 35;
        this.color = colors[Math.floor(Math.random() * colors.length)];
      }
      draw() {
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.radius, 0, Math.PI*2);
        ctx.fillStyle = this.color;
        ctx.fill();
        ctx.strokeStyle = "#fff";
        ctx.stroke();
        ctx.fillStyle = "white";
        ctx.font = "20px Comic Sans MS";
        ctx.textAlign = "center";
        ctx.fillText(this.value, this.x, this.y+7);
      }
      update() {
        this.y -= 1 + level*0.3;
        if(this.y + this.radius < 0){
          this.reset();
        }
        this.draw();
      }
      reset() {
        this.y = canvas.height + this.radius;
        this.x = Math.random() * (canvas.width - this.radius*2) + this.radius;
      }
    }

    function generateQuestion() {
      let a, b;
      if (level <= 3) { // addition
        a = Math.floor(Math.random()*10);
        b = Math.floor(Math.random()*10);
        correctAnswer = a+b;
        question = `${a} + ${b} = ?`;
      } else if (level <= 6) { // subtraction
        a = Math.floor(Math.random()*10+5);
        b = Math.floor(Math.random()*10);
        correctAnswer = a-b;
        question = `${a} - ${b} = ?`;
      } else if (level <= 9) { // division
        b = Math.floor(Math.random()*9)+1;
        correctAnswer = Math.floor(Math.random()*9)+1;
        a = b*correctAnswer;
        question = `${a} √∑ ${b} = ?`;
      } else { // mix
        const type = Math.floor(Math.random()*3);
        return (level = [3,6,9][type]+1, generateQuestion());
      }

      document.getElementById("question").innerText = "Question: " + question;

      balloons = [];
      let correctPlaced = false;
      for(let i=0; i<5; i++){
        let val;
        if(i===4 && !correctPlaced) {
          val = correctAnswer;
          correctPlaced = true;
        } else {
          val = correctAnswer + Math.floor(Math.random()*6)-3;
          if(val<0) val = Math.abs(val);
        }
        balloons.push(new Balloon(Math.random()*700+50, Math.random()*400+200, val, val===correctAnswer));
      }
    }

    function startGame() {
      generateQuestion();
      gameInterval = setInterval(updateGame, 30);
      timerInterval = setInterval(()=>{
        time--;
        document.getElementById("time").innerText = time;
        if(time<=0) endGame(false);
      },1000);
    }

    function updateGame() {
      ctx.clearRect(0,0,canvas.width,canvas.height);
      balloons.forEach(b=>b.update());
    }

    canvas.addEventListener("click", e=>{
      const rect = canvas.getBoundingClientRect();
      const mx = e.clientX - rect.left;
      const my = e.clientY - rect.top;
      balloons.forEach(b=>{
        const dx = mx - b.x;
        const dy = my - b.y;
        if(Math.sqrt(dx*dx+dy*dy) < b.radius){
          if(b.isCorrect){
            score+=10;
            document.getElementById("score").innerText = score;
            level++;
            document.getElementById("level").innerText = level;
            time = 30;
            generateQuestion();
            if(level>10) endGame(true);
          } else {
            score-=5;
            document.getElementById("score").innerText = score;
          }
        }
      });
    });

    function endGame(win){
      clearInterval(gameInterval);
      clearInterval(timerInterval);
      const msg = document.getElementById("message");
      if(win){
        msg.innerText = "üéâ You are a Genius! üéâ";
      } else {
        msg.innerText = "‚è≥ Time's Up! Try Again!";
      }
      msg.style.display = "block";
    }

    startGame();
  </script>
</body>
</html>
